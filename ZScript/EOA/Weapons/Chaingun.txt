Class ChaingunSelected : EOA_Token {}

Class ChaingunSpinCounter : EOA_Token {Default {Inventory.MaxAmount 36;} }

Class ChaingunFireCounter : EOA_Token {Default {Inventory.MaxAmount 8;} }

Class ChaingunSpinupCounter : EOA_Token {}

Class ChaingunSpindownCounter : EOA_Token {}

//Gatling Rotator - Allows you to spin up the barrels without needing to fire.
Class GatlingRotator : EOA_Token {}
Class GatlingRotatorSelected : EOA_Token {}
Class DamageCounter : EOA_Token {Default {Inventory.MaxAmount 400;} }
Class ImprovedTorque : EOA_Token {} //Barrels spin up much faster with the Gatling Rotator.
Class GRUraniumCoating : EOA_Token {} //Shots penetrate enemies.

//Shield
Class ShieldCoolDownToken : EOA_Token{Default {Inventory.MaxAmount 6;}}
Class ShieldTimerToken : EOA_Token{Default {Inventory.MaxAmount 6;}}
Class ThrowShield : EOA_Token{}
Class ShieldCantUse : EOA_token {}
Class UsingShield : EOA_Token{}
Class ShieldBashed : EOA_Token{}

Class ShieldProjectile : EOA_Projectile
{
	default
	{
	Radius 35;
	Height 3;
	speed 56;
	Damage (250);
	Decal "Scorch";
	Scale 2;
	RenderStyle "Add";
	EOA_Projectile.PuffType "GaussCannonProjectilePuff";
	//EOA_Projectile.RipFailChance 4
	+DONTBLAST
	+DONTREFLECT
	+EXTREMEDEATH
	+RIPPER
	}
	States
	{
	Spawn:
		TRAC A 1 Bright
		{
			EOA_SpawnCustomDynamicLight("ShieldLight", DynamicLight.PulseLight, (25, 153, 255), 48, 1, DYNAMICLIGHT.LF_ADDITIVE|DYNAMICLIGHT.LF_ATTENUATE, 3, (0, 0, Height / 2), 0.1);
		}
	Wait;
	XDeath:
		TNT1 A 0 A_StartSound("Gauss/Damage", 1);
	Death:
	Crash:
		TNT1 A 1
		{
			A_SpawnItemEx("GaussCannonProjectilePuff", 0, 0, 0, 0, 0, 0, 0, SXF_NOCHECKPOSITION);
			A_Explode(15 , 80, 0, 1, 80);
			Radius_Quake(5, 10, 0, 10, 0);
			A_StartSound("Gauss/Impact", 2);
			EOA_SpawnCustomDynamicLight("ShieldLight", DynamicLight.PulseLight, (25, 153, 255), 48, 1, DYNAMICLIGHT.LF_ADDITIVE|DYNAMICLIGHT.LF_ATTENUATE, 3, (0, 0, Height / 2), 0.1);
		}
		Stop;
	}
}

Class MC_IncendiaryRounds : EOA_MasteryChallengeToken //Kill 5 enemies within 5 seconds (using the Chaingun with the Gatling Rotator equipped, of course).
{
	Default
	{
		EOA_MasteryChallengeToken.MasteryItem "IncendiaryRounds";
		EOA_MasteryChallengeToken.ChallengeCounter "IncendiaryRounds";
		Tag "Incendiary Rounds";
	}
}

Class IncendiaryRounds : EOA_Token {} //Mastery Upgrade - Shots deal more damage once maximum fire rate has been achieved.

Class IncendiaryRoundsKillCounter1 : EOA_TempToken
{
	Default
	{
		Powerup.Type "PowerIncendiaryRoundsKillCounter1";
		Powerup.Duration -5;
	}
}

Class IncendiaryRoundsKillCounter2 : EOA_TempToken
{
	Default
	{
		Powerup.Type "PowerIncendiaryRoundsKillCounter2";
		Powerup.Duration -5;
	}
}

Class IncendiaryRoundsKillCounter3 : EOA_TempToken
{
	Default
	{
		Powerup.Type "PowerIncendiaryRoundsKillCounter3";
		Powerup.Duration -5;
	}
}

Class IncendiaryRoundsKillCounter4 : EOA_TempToken
{
	Default
	{
		Powerup.Type "PowerIncendiaryRoundsKillCounter4";
		Powerup.Duration -5;
	}
}

Class IncendiaryRoundsKillCounter5 : EOA_TempToken
{
	Default
	{
		Powerup.Type "PowerIncendiaryRoundsKillCounter5";
		Powerup.Duration -5;
	}
}

Class PowerIncendiaryRoundsKillCounter1 : PowerEOA_TempToken {}
Class PowerIncendiaryRoundsKillCounter2 : PowerEOA_TempToken {}
Class PowerIncendiaryRoundsKillCounter3 : PowerEOA_TempToken {}
Class PowerIncendiaryRoundsKillCounter4 : PowerEOA_TempToken {}
Class PowerIncendiaryRoundsKillCounter5 : PowerEOA_TempToken {}

//Mobile Turret - Allows you to fire twice as fast and immediately.  Prone to stalling from extended periods of usage.
Class MobileTurret : EOA_Token {}
Class MobileTurretSelected : EOA_Token {}
Class RapidDeployment : EOA_Token {} //Faster Deployment.
Class MTUraniumCoating : EOA_Token {} //Shots penetrate enemies.

Class MC_UltimateCooling : EOA_MasteryChallengeToken //Kill 4 or more enemies in one deployment 5 times.
{
	Default
	{
		EOA_MasteryChallengeToken.MasteryItem "UltimateCooling";
		EOA_MasteryChallengeToken.ChallengeCounter "UltimateCoolingMasteryCounter";
		Tag "Ultimate Cooling";
	}
}

Class UltimateCooling : EOA_Token {} //Mastery Upgrade - The Mobile Turret will no longer overheat.

Class MobileTurretHeatCounter : EOA_Token {Default {Inventory.MaxAmount 105;} } //3 sec.

Class MobileTurretOverheatCounter : EOA_Token {}
Class MobileTurretReady : EOA_Token {}
Class MobileTurretBarrelCounter : EOA_Token {Default {Inventory.MaxAmount 3;} }
Class UltimateCoolingKillCounter : EOA_Token {Default {Inventory.MaxAmount 4;} }
Class UltimateCoolingMasteryCounter : EOA_Token {Default {Inventory.MaxAmount 5;} }
//Class UltimateCoolingKillSuppressor : EOA_Token {} //So that we're not spammed with mastery ticking sounds once we reach 4 kills with the Mobile Turret.

Class CGNMods : EOA_Manipulator
{
	States
	{
	Pickup:
		TNT1 A 0
		{
			A_GiveInventory("GatlingRotator");
			A_GiveInventory("MobileTurret");
		}
		Stop;
	}
}

Class CGNUpgrades : EOA_Manipulator
{
	States
	{
	Pickup:
		TNT1 A 0
		{
			A_GiveInventory("ImprovedTorque");
			A_GiveInventory("GRUraniumCoating");
			A_GiveInventory("RapidDeployment");
			A_GiveInventory("MTUraniumCoating");
		}
		Stop;
	}
}

Class EOA_Chaingun : EOA_Weapon
{
	State MT_FireState;
	Bool AltHeld;
	Int ShieldCoolDownTimer, ShieldUseTimer;
	Default
	{
		Inventory.Icon "ICONCGN";
		Weapon.AmmoType "EOA_BulletAmmo";
		Weapon.AmmoUse 1;
		Weapon.AmmoGive 90;
		Weapon.SlotNumber 8;
		Inventory.PickupMessage "Delta-12 Chaingun";
		Tag "Delta-12 Chaingun";
	}
	Override Void MarkPrecacheSounds()
	{
		MarkSound("CGN/Fire");
		MarkSound("CGN/Fire/Uranium");
		MarkSound("CGN/Stop");
		MarkSound("CGN/MTOverheat");
		MarkSound("CGN/Rotor");
		MarkSound("Chaingun/ESpin");
		MarkSound("Chaingun/ESpin2");
		MarkSound("Chaingun/ESpin3");
		MarkSound("Chaingun/ESpin4");
		MarkSound("Chaingun/ESpin5");
		MarkSound("CGN/Spin");
		MarkSound("CGN/MTOpen");
		MarkSound("CGN/MTClose");
		MarkSound("CGN/MTFire");
		MarkSound("CGN/MTFire/Uranium");
		MarkSound("CGN/MTCasings");
		MarkSound("GatlingRotator/Click");
		MarkSound("GatlingRotator/Attach");
		MarkSound("GatlingRotator/Punch");
		MarkSound("MobileTurret/Attach");
		MarkSound("MobileTurret/Lock");
		MarkSound("MobileTurret/Whirr");
		Super.MarkPrecacheSounds();
	}
	Override Void BeginPlay()
	{
		MT_FireState = FindState("TurretFire");
		ShieldCoolDownTimer = 35;
		ShieldUseTimer = 35;
		Super.BeginPlay();
	}
	Override Void DoEffect()
	{
		Let Player = Owner.Player;
		If (!Player)
		{
			Super.DoEffect();
			Return;
		}
		if ((Owner.GetPlayerInput(INPUT_BUTTONS) & BT_ALTATTACK))
		AltHeld = True;
		Else
		AltHeld = False;
		//Mod not equipped...
		If ((Owner.GetPlayerInput(INPUT_BUTTONS) & BT_ALTATTACK) && !(Owner.GetPlayerInput(INPUT_OLDBUTTONS) & BT_ALTATTACK) && Player.ReadyWeapon == Self && !(Owner.CountInv("GatlingRotatorSelected") || Owner.CountInv("MobileTurretSelected")))
		{
			EOA_SpawnNoiseMaker("Weapon/DryFire");
		}
		/*Else If ((Player.ReadyWeapon Is "EOA_Chaingun") &&(Owner.GetPlayerInput(INPUT_BUTTONS) & BT_ALTATTACK) && !(Owner.GetPlayerInput(INPUT_OLDBUTTONS) & BT_ALTATTACK) && (Owner.GetPlayerInput(INPUT_BUTTONS) & BT_ATTACK) && (Owner.CountInv("GatlingRotatorSelected")))
		{
			Player.FindPSprite(PSP_WEAPON).SetState(ResolveState("AltFire"));
		}**/
		if(!(Owner.GetPlayerInput(INPUT_BUTTONS) & BT_ALTATTACK) && Owner.CountInv("UsingShield"))
		{
			Player.FindPSprite(PSP_WEAPON).SetState(ResolveState("ShieldBreak"));
		}
		//Cooldown
		Owner.A_TakeInventory("MobileTurretHeatCounter", 1 + Owner.CountInv("PowerHaste"));

		/*A_GiveInventory("ShieldCoolDownToken", 6);
		A_GiveInventory("ShieldTimerToken", 6);
		A_GiveInventory("UsingShield", 1);*/
		//Console.PrintF(String.Format("T:%i CD:%i", ShieldUseTimer, ShieldCoolDownTimer));
		//shield crap
		If(Owner.CountInv("ShieldTimerToken"))
		{
			ShieldUseTimer--;
		}
		If(ShieldUseTimer <= 0)
		{
			ShieldUseTimer = 35;
			Owner.A_TakeInventory("ShieldTimerToken", 1);
			If(!Owner.CountInv("ShieldTimerToken"))
			Owner.A_TakeInventory("UsingShield");
		}
		
		If(Owner.CountInv("ShieldCoolDownToken") && !Owner.CountInv("ShieldTimerToken") && !Owner.CountInv("UsingShield"))
		{
			ShieldCoolDownTimer--;
		}
		If(ShieldCoolDownTimer <= 0)
		{
			ShieldCoolDownTimer = 35;
			Owner.A_TakeInventory("ShieldCoolDownToken", 1);
			//Console.PrintF("can use shield");
		}

		//Mastery - Incendiary Rounds (Gatling Rotator)
		If (!Owner.CountInv("IncendiaryRounds") && Owner.CountInv("ImprovedTorque") && Owner.CountInv("GRUraniumCoating"))
		{
			Owner.A_GiveInventory("MC_IncendiaryRounds");
			If (Owner.CountInv("PowerIncendiaryRoundsKillCounter1") && Owner.CountInv("PowerIncendiaryRoundsKillCounter2") && Owner.CountInv("PowerIncendiaryRoundsKillCounter3") && Owner.CountInv("PowerIncendiaryRoundsKillCounter4") && Owner.CountInv("PowerIncendiaryRoundsKillCounter5") && !Owner.CountInv("IncendiaryRounds"))
			{
				Owner.A_GiveInventory("IncendiaryRounds");
			}
		}
		Else
		{
			Owner.A_TakeInventory("MC_IncendiaryRounds");
		}
		
		//Mastery - Ultimate Cooling (Mobile Turret)
		If (!Owner.CountInv("UltimateCooling") && Owner.CountInv("RapidDeployment") && Owner.CountInv("MTUraniumCoating"))
		{
			Owner.A_GiveInventory("MC_UltimateCooling");
			If (Owner.CountInv("UltimateCoolingMasteryCounter") >= 5)
			{
				Owner.A_GiveInventory("UltimateCooling");
				Owner.A_TakeInventory("UltimateCoolingMasteryCounter");
			}
		}
		Else
		{
			Owner.A_TakeInventory("MC_UltimateCooling");
		}
		If (Owner.CountInv("MobileTurretOverheatCounter"))
		{
			Owner.A_TakeInventory("UltimateCoolingKillCounter");
		}
		
		//Spin Handler
		If (Player.ReadyWeapon == Self)
		{
			If (((Owner.GetPlayerInput(INPUT_BUTTONS) & BT_ATTACK) || ((Owner.GetPlayerInput(INPUT_BUTTONS) & BT_ATTACK) && Owner.CountInv("GatlingRotatorSelected"))) && Owner.CountInv("ChaingunSpinupCounter") && (!Owner.CountInv("MobileTurretReady") || !Owner.CountInv("MobileTurretOverheatCounter")))
			{
				If (((Owner.GetPlayerInput(INPUT_BUTTONS) & BT_ATTACK) && !(Owner.GetPlayerInput(INPUT_OLDBUTTONS) & BT_ATTACK)) && Owner.CountInv("GatlingRotatorSelected") && !Owner.CountInv("MobileTurretSelected") || !Owner.CountInv("ChaingunSpinCounter"))
				{
					Owner.A_TakeInventory("ChaingunSpindownCounter");
				}
				Owner.A_GiveInventory("ChaingunSpinCounter", 1 + (Owner.CountInv("GatlingRotatorSelected") && Owner.CountInv("ImprovedTorque")));
			}
			Else
			{
				If (Owner.CountInv("ChaingunSpinCounter") && !Owner.CountInv("ChaingunSpindownCounter"))
				{
					Owner.A_GiveInventory("ChaingunSpindownCounter");
				}
				If (!Owner.CountInv("ChaingunSpinCounter"))
				{
					Owner.A_TakeInventory("ChaingunSpindownCounter");
				}
				Owner.A_TakeInventory("ChaingunSpinCounter", 1);
			}
			If (Owner.CountInv("MobileTurretReady") && (Owner.GetPlayerInput(INPUT_BUTTONS) & BT_ATTACK) && (Owner.CountInv("EOA_BulletAmmo") || CheckInfiniteAmmo()) && !Owner.CountInv("MobileTurretOverheatCounter"))
			{
				Owner.A_GiveInventory("MobileTurretHeatCounter", 2 * (1 + Owner.CountInv("PowerHaste")));
				If (Owner.CountInv("UltimateCooling")) //[DoomKrakken]: The counter increments, but will never reach its maximum.
				{
					If ((Owner.CountInv("MobileTurretHeatCounter") >= 39 && !(Owner.CountInv("MobileTurretBarrelCounter") % randompick(1, 1, 3))) || (Owner.CountInv("MobileTurretHeatCounter") >= 65 && !(Owner.CountInv("MobileTurretBarrelCounter") % randompick(1, 1, 1, 3))) || (Owner.CountInv("MobileTurretHeatCounter") >= 78 && !(Owner.CountInv("MobileTurretBarrelCounter") % randompick(1, 1, 2))) || (Owner.CountInv("MobileTurretHeatCounter") >= 95 && !(Owner.CountInv("MobileTurretBarrelCounter") % randompick(1, 1, 1, 2))))
					{
						Owner.A_TakeInventory("MobileTurretHeatCounter", 1 + Owner.CountInv("PowerHaste"));
					}
				}
			}
			If (Owner.CountInv("MobileTurretHeatCounter") >= 105 && !Owner.CountInv("UltimateCooling"))
			{
				EOA_SpawnNoiseMaker("CGN/MTOverheat");
				Owner.A_GiveInventory("MobileTurretOverheatCounter");
			}
			If (!Owner.CountInv("MobileTurretHeatCounter"))
			{
				Owner.A_TakeInventory("MobileTurretOverheatCounter");
			}
			If (Owner.CountInv("ChaingunSpinCounter"))
			{
				//EOA_SpawnPersistentNoiseMaker(SlotNumber, "CGN/Rotor", 6, CHANF_OVERLAP|CHANF_LOOPING, 0.4 * Owner.CountInv("ChaingunSpinCounter") / 36);
				EOA_SpawnPersistentNoiseMaker(SlotNumber, "CGN/Spin", 6, CHANF_OVERLAP|CHANF_LOOPING, 0.4 * Owner.CountInv("ChaingunSpinCounter") / 36);
				//EOA_SpawnPersistentNoiseMaker(SlotNumber, "Chaingun/ESpin", 6, CHANF_OVERLAP|CHANF_LOOPING, 0.4 * Owner.CountInv("ChaingunSpinCounter") / 36);
			}
			Else If (Owner.IsActorPlayingSound(SlotNumber * 100 + 6, "CGN/Rotor") || Owner.IsActorPlayingSound(SlotNumber * 100 + 6, "CGN/Spin"))
			{
				EOA_SpawnPersistentNoiseMaker(SlotNumber, "", 6);
			}
		}
		If (Owner && Owner.Player && Owner.Player.ReadyWeapon && Owner.Player.ReadyWeapon != Self)
		{
			If (Owner.CountInv("ChaingunSelected"))
			{
				Owner.A_TakeInventory("ChaingunSelected");
				Owner.A_TakeInventory("ChaingunSpinCounter");
				Owner.A_TakeInventory("MobileTurretReady");
				Owner.A_TakeInventory("UltimateCoolingKillCounter");
				EOA_SpawnPersistentNoiseMaker(SlotNumber, "", 1);
				EOA_SpawnPersistentNoiseMaker(SlotNumber, "", 5);
				EOA_SpawnPersistentNoiseMaker(SlotNumber, "", 6);
				FOVScale = 1;
			}
		}
		Super.DoEffect();
	}
	Action Void EOA_ShieldOverHeat(Int DistThresh, Double AngThresh) //[DoomKrakken]: Derived from A_Blast.  Modified to only work within a certain angle. :D
	{
		Bool BlastCheck;
		Actor BlastWave;
		[BlastCheck, BlastWave] = A_SpawnItemEx("StunBombProjectileExplosionFX", 0, 0, Height / 2);//Spawn("HeatBlastWave", (Pos.X, Pos.Y, Pos.Z + Height / 2), NO_REPLACE);
		If (BlastWave)
		{
			//BlastWave.Pitch = Pitch;
			//BlastWave.Angle = Angle;
			//[DoomKrakken]: Spawn four more in the same fashion, for better brightness. :D
			//[Fat Tony] : no.
			A_SpawnItemEx("StunBombProjectileExplosionFX", 0, 0, Height / 2);
			//StunBombProjectileExplosionFX
		}
		ThinkerIterator it = ThinkerIterator.Create("Actor");
		Actor Mo;
		While (Mo = Actor(it.Next()))
		{
			//Check for the Heat Blast Wave
			If (!BlastWave || Mo == Self || !Mo.bSHOOTABLE || Distance3D(Mo) > DistThresh)
            {
                Continue;
            }			
			//Gotta be somewhat in front of you.  Remember, this heat blast isn't a fart... (thank you, Kodi, Xangi, and Gutawer!)
			Vector3 posDif = self.Vec3To(Mo); //Difference in position between inflictor and victim.
			Double relAngle = DeltaAngle(Self.Angle, atan2(posDif.Y, posDif.X)); //Difference in angle between inflictor and victim.
            If (abs(relAngle) >= AngThresh)
            {
                Continue;
            }
			If (Mo.CurSector.PortalGroup != CurSector.PortalGroup || !CheckSight(Mo) || Mo.bKILLED)
			{
				Continue;
			}
			Mo.Target = Self;
			Mo.DamageMobj(BlastWave, Self, 150, "Normal", Flags: DMG_EXPLOSION);
			Mo.A_FaceTarget();
		}
	}
	Override Double GetSpeedFactor()
	{
		If (Owner && Owner.Player && Owner.Player.ReadyWeapon && Owner.Player.ReadyWeapon == Self)
		{
			Let PSP = Owner.Player.FindPSprite(PSP_WEAPON);
			If (PSP && InStateSequence(PSP.CurState, MT_FireState))
			{
				Return 0.5;
			}
		}
		Return 1.0;
	}
	States
	{
	Spawn:
		CGUN A -1;
		Stop;
	Select:
		TNT1 A 0
		{
			Invoker.SemiAutoOverride = True;
			A_Overlay(-8, "ShieldHandler");
			A_GiveInventory("ChaingunSelected");
			If (GetCVar("EOA_Reticles"))
			{
				ACS_NamedExecuteAlways("CGNReticle", 0);
				A_SetCrosshair(99);
			}
			Else
			{
				A_SetCrosshair(0);
			}
			A_GiveInventory("ChaingunSpinupCounter");
			//A_Overlay(-50, "EquipmentHandler", 1);
		}
		TNT1 A 0 A_Raise();
		Wait;
	Deselect:
		TNT1 A 0
		{
			A_TakeInventory("SwitchStyleDelay", 10);
			A_StopSound(CHAN_WEAPON);
			A_TakeInventory("DamageCounter", 400);
			If(CountInv("UsingShield"))
			{
				bDONTTHRUST = False;
				bINVULNERABLE = False;
				A_TakeInventory("UsingShield", 1);
				A_TakeInventory("ShieldTimerToken", 6);
			}
		}
		TNT1 A 0 A_JumpIfInventory("MobileTurretReady", 1, "TurretClose");
		CGRR A 0 A_JumpIfInventory("GatlingRotatorSelected", 1, 3);
		CGMR A 0 A_JumpIfInventory("MobileTurretSelected", 1, 2);
		CGNR A 0;
		"####" HFDB 1;
		TNT1 A 4
		{
			A_ZoomFactor();
			A_TakeInventory("ChaingunSpinCounter");
			A_TakeInventory("MobileTurretReady");
			A_TakeInventory("UltimateCoolingKillCounter");
			EOA_SpawnPersistentNoiseMaker(Invoker.SlotNumber, "", 1);
			EOA_SpawnPersistentNoiseMaker(Invoker.SlotNumber, "", 5);
			EOA_SpawnPersistentNoiseMaker(Invoker.SlotNumber, "", 6);
			A_SetTics(4 * !CountInv("Adept") * !CountInv("PowerBerserk"));
		}
		TNT1 A 0 
		{
			A_TakeInventory("ChaingunSelected");
			A_Lower(36);
		}
		Wait;
	Ready:
		TNT1 A 0
		{
			If (Level.Time && !(CountInv("GatlingRotatorSwitch") || CountInv("MobileTurretSwitch")))
			{
				EOA_SpawnNoiseMaker("Weapon/Switch");
			}
		}
		CGRR A 0 A_JumpIfInventory("GatlingRotatorSelected", 1, 3);
		CGMR A 0 A_JumpIfInventory("MobileTurretSelected", 1, 2);
		CGNR A 0;
		"####" ACEG 1
		{
			EOA_WeaponReady(WRF_NOFIRE|WRF_NOBOB|WRF_NOSWITCH, EOA_ALLOWMANTLE|EOA_DISABLEHASTE);
			If (CountInv("GatlingRotatorSwitch"))
			{
				A_TakeInventory("GatlingRotatorSwitch");
				Return ResolveState("GatlingRotatorMod");
			}
			Else If (CountInv("MobileTurretSwitch"))
			{
				A_TakeInventory("MobileTurretSwitch");
				Return ResolveState("MobileTurretMod");
			}
			Return ResolveState(Null);
		}
		Goto ReadyLoop;
	ReRaise:
		"####" "#" 0 A_GiveInventory("ChaingunSpinupCounter");
		CGRR A 0 A_JumpIfInventory("GatlingRotatorSelected", 1, 3);
		CGMR A 0 A_JumpIfInventory("MobileTurretSelected", 1, 2);
		CGNR A 0;
		"####" CDEFGH 1 EOA_WeaponReady(WRF_NOFIRE|WRF_NOBOB|WRF_NOSWITCH, EOA_ALLOWMANTLE|EOA_DISABLEHASTE);
	ReadyLoop:
		CGRI B 0 A_JumpIf(CountInv("GatlingRotatorSelected") && !CountInv("UsingShield") && CountInv("ShieldCoolDownToken") > 4, 6);
		CGRI C 0 A_JumpIf(CountInv("GatlingRotatorSelected") && !CountInv("UsingShield") && CountInv("ShieldCoolDownToken") > 2, 5);
		CGRI D 0 A_JumpIf(CountInv("GatlingRotatorSelected") && !CountInv("UsingShield") && CountInv("ShieldCoolDownToken") > 0, 4);
		CGRI A 0 A_JumpIfInventory("GatlingRotatorSelected", 1, 3);
		CGMI A 0 A_JumpIfInventory("MobileTurretSelected", 1, 2);
		CGNI A 0;
		"####" "#" 1 
		{
			EOA_WeaponReady(WRF_NOPRIMARY * (((GetPlayerInput(INPUT_BUTTONS) & BT_ATTACK) && CountInv("MobileTurretSelected") && CountInv("MobileTurretOverheatCounter")))|WRF_NOSECONDARY * CountInv("UsingShield")|WRF_ALLOWRELOAD * ((CountInv("GatlingRotator") && CountInv("MobileTurret")) || ((CountInv("GatlingRotator") || CountInv("MobileTurret")) && (!CountInv("GatlingRotatorSelected") && !CountInv("MobileTurretSelected"))))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_ALLOWEQUIPMENT);
			A_StopSound(CHAN_WEAPON);
			A_GiveInventory("ChaingunSpinupCounter");
			A_ZoomFactor(1);
			A_Overlay(-50, "EquipmentHandler", 1);
			If (CountInv("Grabbing_A_Ledge"))
			{
				A_TakeInventory("ChaingunFireCounter");
			}
			If (CountInv("GatlingRotatorSwitch"))
			{
				A_TakeInventory("GatlingRotatorSwitch");
				Return ResolveState("SwitchToGatlingRotator");
			}
			Else If (CountInv("MobileTurretSwitch"))
			{
				A_TakeInventory("MobileTurretSwitch");
				Return ResolveState("SwitchToMobileTurret");
			}
			/*Else If (((GetPlayerInput(INPUT_BUTTONS) & BT_ALTATTACK) && CountInv("GatlingRotatorSelected")) || ((GetPlayerInput(INPUT_BUTTONS) & BT_ATTACK) && CountInv("MobileTurretSelected") && CountInv("MobileTurretOverheatCounter")))
			{
				A_TakeInventory("ChaingunFireCounter");
				Return ResolveState("SpinAnim1");
			}*/
			Return ResolveState(Null);
		}
		Loop;
	ShieldHandler:
		TNT1 A 1
		{
			If (CountInv("UsingShield") && !CountInv("ShieldBashed"))
			{
				A_Overlay(-16, "ShieldOverlay");
			}
			If (CountInv("ShieldBashed"))
			{
				A_OverLay(-15, "ShieldHit", 1);
			}
		}
		Loop;
	ShieldActivate:
		GSDA ACEG 1 Bright;
		Stop;
	ShieldOverlay:
		CGSD A 1 Bright EOA_SpawnCustomDynamicLight("CGNLight", DynamicLight.PulseLight, (25, 153, 255), 48, 1, DYNAMICLIGHT.LF_ADDITIVE|DYNAMICLIGHT.LF_ATTENUATE, 3, (0, 0, Height / 2), 0.1);
		Stop;
	ShieldHit:
		TNT1 A 0 EOA_SpawnNoiseMaker("Shield/Impact");
		CGSD B 8 Bright 
		{
			A_TakeInventory("ShieldBashed");
			EOA_SpawnCustomDynamicLight("CGNLight", DynamicLight.PulseLight, (255, 110, 110), 48, 1, DYNAMICLIGHT.LF_ADDITIVE|DYNAMICLIGHT.LF_ATTENUATE, 3, (0, 0, Height / 2), 0.1);
		}
		Stop;
	Fire:
		CG1F A 0 A_JumpIf(CountInv("GatlingRotatorSelected") && !CountInv("UsingShield") && CountInv("ShieldCoolDownToken") > 4, 6);
		CG2F A 0 A_JumpIf(CountInv("GatlingRotatorSelected") && !CountInv("UsingShield") && CountInv("ShieldCoolDownToken") > 2, 5);
		CG3F A 0 A_JumpIf(CountInv("GatlingRotatorSelected") && !CountInv("UsingShield") && CountInv("ShieldCoolDownToken") > 0, 4);
		CGRF A 0 A_JumpIfInventory("GatlingRotatorSelected", 1, 3);
		CGMF A 0 A_JumpIfInventory("MobileTurretSelected", 1, 2);
		CGNF A 0;
		"####" "#" 0
		{
			A_GiveInventory("ChaingunSpinupCounter");
			A_StartSound("CGN/Rotor",CHAN_WEAPON,CHANF_OVERLAP|CHANF_LOOPING, 10.0);
			A_StartSound("CGN/Rotor",CHAN_WEAPON,CHANF_OVERLAP|CHANF_LOOPING, 10.0);
			A_StartSound("CGN/Rotor",CHAN_WEAPON,CHANF_OVERLAP|CHANF_LOOPING, 10.0);
			A_StartSound("CGN/Rotor",CHAN_WEAPON,CHANF_OVERLAP|CHANF_LOOPING, 10.0);
			A_StartSound("CGN/Rotor",CHAN_WEAPON,CHANF_OVERLAP|CHANF_LOOPING, 10.0);
			A_StartSound("Chaingun/ESpin",CHAN_WEAPON,CHANF_OVERLAP|CHANF_LOOPING);
			A_StartSound("Chaingun/ESpin2",CHAN_WEAPON,CHANF_OVERLAP|CHANF_LOOPING);
			A_StartSound("Chaingun/ESpin3",CHAN_WEAPON,CHANF_OVERLAP|CHANF_LOOPING,0.75);
			A_StartSound("Chaingun/ESpin4",CHAN_WEAPON,CHANF_OVERLAP|CHANF_LOOPING,0.25);
			A_StartSound("Chaingun/ESpin5",CHAN_WEAPON,CHANF_OVERLAP|CHANF_LOOPING,0.25);
			If (CountInv("SoundCounter") >= 4)
			{
				A_TakeInventory("SoundCounter");
			}
			A_GiveInventory("SoundCounter");
			If (CountInv("ChaingunFireCounter") >= 8)
			{
				A_TakeInventory("ChaingunFireCounter");
			}
			A_GiveInventory("ChaingunFireCounter");
			EOA_FireBullets(CountInv("ChaingunSpinCounter") / 12.0, CountInv("ChaingunSpinCounter") / 12.0, -1, 0, "EOA_NullPuff", FBF_NORANDOMPUFFZ|FBF_USEAMMO, 32767, "ChaingunSlug", -3 + GetViewZ(), 5 + GetRelVelY() / 3);
			If (GetCVar("EOA_APRRecoil"))
			{
				A_ZoomFactor(0.993, ZOOM_NOSCALETURNING);
			}
			A_FireProjectile("EMGCasingSpawner", -60, 0, 3, 2, 0, -(5 + Pitch / 2));
			A_AlertMonsters();
			If (CountInv("PowerQDMG"))
			{
				EOA_SpawnNoiseMaker("QuadDamage/Shot");
			}
			EOA_SpawnCustomDynamicLight("CGNLight", DynamicLight.PulseLight, (25, 153, 255), 48, 1, DYNAMICLIGHT.LF_ADDITIVE|DYNAMICLIGHT.LF_ATTENUATE, 3, (0, 0, Height / 2), 0.1);
			EOA_SpawnPersistentNoiseMaker(Invoker.SlotNumber, "CGN/Fire", 1 + CountInv("SoundCounter"));
		}
		"####" "#" 0 A_JumpIfInventory("ChaingunFireCounter", 8, "FireAnim8");
		"####" "#" 0 A_JumpIfInventory("ChaingunFireCounter", 7, "FireAnim7");
		"####" "#" 0 A_JumpIfInventory("ChaingunFireCounter", 6, "FireAnim6");
		"####" "#" 0 A_JumpIfInventory("ChaingunFireCounter", 5, "FireAnim5");
		"####" "#" 0 A_JumpIfInventory("ChaingunFireCounter", 4, "FireAnim4");
		"####" "#" 0 A_JumpIfInventory("ChaingunFireCounter", 3, "FireAnim3");
		"####" "#" 0 A_JumpIfInventory("ChaingunFireCounter", 2, "FireAnim2");
		"####" "#" 0 A_JumpIfInventory("ChaingunFireCounter", 1, "FireAnim1");
	FireAnim1:
		"####" A 1
		{
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !(CountInv("MobileTurretSelected") && !CountInv("MobileTurretOverheatCounter"))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_DISABLEHASTE);
		}
		"####" BC 1
		{
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !(CountInv("MobileTurretSelected") && !CountInv("MobileTurretOverheatCounter"))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_DISABLEHASTE);
		}
		"####" "#" 0 
		{
			A_ZoomFactor(1, ZOOM_NOSCALETURNING|ZOOM_INSTANT);
			A_ReFire();
		}
		Goto SpinAnim2;
	FireAnim2:
		"####" D 1
		{
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !(CountInv("MobileTurretSelected") && !CountInv("MobileTurretOverheatCounter"))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_DISABLEHASTE);
		}
		"####" EA 1
		{
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !(CountInv("MobileTurretSelected") && !CountInv("MobileTurretOverheatCounter"))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_DISABLEHASTE);
		}
		"####" "#" 0 
		{
			A_ZoomFactor(1, ZOOM_NOSCALETURNING|ZOOM_INSTANT);
			A_ReFire();
		}
		Goto SpinAnim2;
	FireAnim3:
		"####" B 1
		{
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !(CountInv("MobileTurretSelected") && !CountInv("MobileTurretOverheatCounter"))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_DISABLEHASTE);
		}
		"####" CD 1
		{
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !(CountInv("MobileTurretSelected") && !CountInv("MobileTurretOverheatCounter"))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_DISABLEHASTE);
		}
		"####" "#" 0 
		{
			A_ZoomFactor(1, ZOOM_NOSCALETURNING|ZOOM_INSTANT);
			A_ReFire();
		}
		Goto SpinAnim2;
	FireAnim4:
		"####" E 1
		{
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !(CountInv("MobileTurretSelected") && !CountInv("MobileTurretOverheatCounter"))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_DISABLEHASTE);
		}
		"####" AB 1
		{
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !(CountInv("MobileTurretSelected") && !CountInv("MobileTurretOverheatCounter"))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_DISABLEHASTE);
		}
		"####" "#" 0 
		{
			A_ZoomFactor(1, ZOOM_NOSCALETURNING|ZOOM_INSTANT);
			A_ReFire();
		}
		Goto SpinAnim2;
	FireAnim5:
		"####" C 1
		{
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !(CountInv("MobileTurretSelected") && !CountInv("MobileTurretOverheatCounter"))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_DISABLEHASTE);
		}
		"####" DE 1
		{
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !(CountInv("MobileTurretSelected") && !CountInv("MobileTurretOverheatCounter"))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_DISABLEHASTE);
		}
		"####" "#" 0 
		{
			A_ZoomFactor(1, ZOOM_NOSCALETURNING|ZOOM_INSTANT);
			A_ReFire();
		}
		Goto SpinAnim2;
	FireAnim6:
		"####" A 1
		{
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !(CountInv("MobileTurretSelected") && !CountInv("MobileTurretOverheatCounter"))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_DISABLEHASTE);
		}
		"####" BC 1
		{
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !(CountInv("MobileTurretSelected") && !CountInv("MobileTurretOverheatCounter"))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_DISABLEHASTE);
		}
		"####" "#" 0 
		{
			A_ZoomFactor(1, ZOOM_NOSCALETURNING|ZOOM_INSTANT);
			A_ReFire();
		}
		Goto SpinAnim2;
	FireAnim7:
		"####" D 1
		{
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !(CountInv("MobileTurretSelected") && !CountInv("MobileTurretOverheatCounter"))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_DISABLEHASTE);
		}
		"####" EA 1
		{
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !(CountInv("MobileTurretSelected") && !CountInv("MobileTurretOverheatCounter"))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_DISABLEHASTE);
		}
		"####" "#" 0 
		{
			A_ZoomFactor(1, ZOOM_NOSCALETURNING|ZOOM_INSTANT);
			A_ReFire();
		}
		Goto SpinAnim2;
	FireAnim8:
		"####" B 1
		{
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !(CountInv("MobileTurretSelected") && !CountInv("MobileTurretOverheatCounter"))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_DISABLEHASTE);
		}
		"####" CD 1
		{
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !(CountInv("MobileTurretSelected") && !CountInv("MobileTurretOverheatCounter"))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_DISABLEHASTE);
		}
		"####" "#" 0 
		{
			A_ZoomFactor(1, ZOOM_NOSCALETURNING|ZOOM_INSTANT);
			A_ReFire();
		}
		Goto SpinAnim2;
	SpinAnim1:
		CGRS A 0 A_JumpIfInventory("GatlingRotatorSelected", 1, 3);
		CGMS A 0 A_JumpIfInventory("MobileTurretSelected", 1, 2);
		CGNS A 0;
		"####" ABC 1
		{
			A_GiveInventory("ChaingunSpinupCounter");
			If (CountInv("Grabbing_A_Ledge"))
			{
				A_TakeInventory("ChaingunFireCounter");
			}
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !CountInv("MobileTurretSelected")|WRF_ALLOWRELOAD * ((CountInv("GatlingRotator") && CountInv("MobileTurret")) || ((CountInv("GatlingRotator") || CountInv("MobileTurret")) && (!CountInv("GatlingRotatorSelected") && !CountInv("MobileTurretSelected"))))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_ALLOWEQUIPMENT|EOA_DISABLEHASTE);
			If (CountInv("PowerHaste"))
			{
				If (GetSpeedCounter() >= 2)
				{
					SetSpeedCounter(0);
				}
				Else
				{
					SetSpeedCounter(GetSpeedCounter() + 1);
				}
			}
			//A_SetTics(4 - (CountInv("PowerHaste") && GetSpeedCounter()) - CountInv("ChaingunSpinCounter") / 12);
			If (CountInv("ChaingunFireCounter") >= 8)
			{
				A_TakeInventory("ChaingunFireCounter");
			}
			A_GiveInventory("ChaingunFireCounter");
		}
		"####" "#" 0
		{
			//[DoomKrakken]: Using A_SetInventory will ensure that the correct amount of counters are present so that it'll go to the correct firing animation state sequence.  They'll be offset by 1 because counters are given when the Chaingun actually fires.
			A_SetInventory("ChaingunFireCounter", 0);
			If ((GetPlayerInput(INPUT_BUTTONS) & BT_ATTACK) && CountInv("MobileTurretSelected") && CountInv("MobileTurretOverheatCounter"))
			{
				A_ReFire("SpinAnim2"); //Because you're able to spin your barrels, but you can't fire if the Mobile Turret is stalled.  If you reeeeaaaally want to fire sooner, switch over to the Gatling Rotator... or watch your heat more carefully. ;)
			}
			Else
			{
				EOA_WeaponReady(WRF_NOSECONDARY|WRF_ALLOWZOOM|WRF_ALLOWRELOAD * ((CountInv("GatlingRotator") && CountInv("MobileTurret")) || ((CountInv("GatlingRotator") || CountInv("MobileTurret")) && (!CountInv("GatlingRotatorSelected") && !CountInv("MobileTurretSelected")))));
			}
		}
	SpinAnim2:
		CG1S A 0 A_JumpIf(CountInv("GatlingRotatorSelected") && !CountInv("UsingShield") && CountInv("ShieldCoolDownToken") > 4, 6);
		CG2S A 0 A_JumpIf(CountInv("GatlingRotatorSelected") && !CountInv("UsingShield") && CountInv("ShieldCoolDownToken") > 2, 5);
		CG3S A 0 A_JumpIf(CountInv("GatlingRotatorSelected") && !CountInv("UsingShield") && CountInv("ShieldCoolDownToken") > 0, 4);
		CGRS A 0 A_JumpIfInventory("GatlingRotatorSelected", 1, 3);
		CGMS A 0 A_JumpIfInventory("MobileTurretSelected", 1, 2);
		CGNS A 0;
		"####" DE 1
		{
			A_GiveInventory("ChaingunSpinupCounter");
			If (CountInv("Grabbing_A_Ledge"))
			{
				A_TakeInventory("ChaingunFireCounter");
			}
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !CountInv("MobileTurretSelected")|WRF_ALLOWRELOAD * ((CountInv("GatlingRotator") && CountInv("MobileTurret")) || ((CountInv("GatlingRotator") || CountInv("MobileTurret")) && (!CountInv("GatlingRotatorSelected") && !CountInv("MobileTurretSelected"))))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_ALLOWEQUIPMENT|EOA_DISABLEHASTE);
			If (CountInv("PowerHaste"))
			{
				If (GetSpeedCounter() >= 2)
				{
					SetSpeedCounter(0);
				}
				Else
				{
					SetSpeedCounter(GetSpeedCounter() + 1);
				}
			}
			//A_SetTics(4 - (CountInv("PowerHaste") && GetSpeedCounter()) - CountInv("ChaingunSpinCounter") / 12);
			If (CountInv("ChaingunFireCounter") >= 8)
			{
				A_TakeInventory("ChaingunFireCounter");
			}
			A_GiveInventory("ChaingunFireCounter");
		}
		"####" "#" 0
		{
			A_SetInventory("ChaingunFireCounter", 1);
			If ((GetPlayerInput(INPUT_BUTTONS) & BT_ATTACK) && CountInv("MobileTurretSelected") && CountInv("MobileTurretOverheatCounter"))
			{
				//A_ReFire("SpinAnim3");
			}
			Else
			{
				A_WeaponReady(WRF_NOSECONDARY|WRF_ALLOWZOOM|WRF_ALLOWRELOAD * ((CountInv("GatlingRotator") && CountInv("MobileTurret")) || ((CountInv("GatlingRotator") || CountInv("MobileTurret")) && (!CountInv("GatlingRotatorSelected") && !CountInv("MobileTurretSelected")))));
			}
		}
		Goto SpinHalt;
	SpinAnim3:
		CGRS A 0 A_JumpIfInventory("GatlingRotatorSelected", 1, 3);
		CGMS A 0 A_JumpIfInventory("MobileTurretSelected", 1, 2);
		CGNS A 0;
		"####" GHA 1 //[DoomKrakken]: Shoutout to my boi, XSlayer! :D
		{
			A_GiveInventory("ChaingunSpinupCounter");
			If (CountInv("Grabbing_A_Ledge"))
			{
				A_TakeInventory("ChaingunFireCounter");
			}
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !CountInv("MobileTurretSelected")|WRF_ALLOWRELOAD * ((CountInv("GatlingRotator") && CountInv("MobileTurret")) || ((CountInv("GatlingRotator") || CountInv("MobileTurret")) && (!CountInv("GatlingRotatorSelected") && !CountInv("MobileTurretSelected"))))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_ALLOWEQUIPMENT|EOA_DISABLEHASTE);
			If (CountInv("PowerHaste"))
			{
				If (GetSpeedCounter() >= 2)
				{
					SetSpeedCounter(0);
				}
				Else
				{
					SetSpeedCounter(GetSpeedCounter() + 1);
				}
			}
			//A_SetTics(4 - (CountInv("PowerHaste") && GetSpeedCounter()) - CountInv("ChaingunSpinCounter") / 12);
			If (CountInv("ChaingunFireCounter") >= 8)
			{
				A_TakeInventory("ChaingunFireCounter");
			}
			A_GiveInventory("ChaingunFireCounter");
			If (CountInv("ChaingunSpinCounter") <= 6 && GetFrame() == 0)
			{
				Return ResolveState("SpinHalt");
			}
			Return ResolveState(Null);
		}
		"####" "#" 0
		{
			A_SetInventory("ChaingunFireCounter", 2);
			If ((GetPlayerInput(INPUT_BUTTONS) & BT_ATTACK) && CountInv("MobileTurretSelected") && CountInv("MobileTurretOverheatCounter"))
			{
				A_ReFire("SpinAnim4");
			}
			Else
			{
				EOA_WeaponReady(WRF_NOSECONDARY|WRF_ALLOWZOOM|WRF_ALLOWRELOAD * ((CountInv("GatlingRotator") && CountInv("MobileTurret")) || ((CountInv("GatlingRotator") || CountInv("MobileTurret")) && (!CountInv("GatlingRotatorSelected") && !CountInv("MobileTurretSelected")))));
			}
		}
	SpinAnim4:
		CGRS A 0 A_JumpIfInventory("GatlingRotatorSelected", 1, 3);
		CGMS A 0 A_JumpIfInventory("MobileTurretSelected", 1, 2);
		CGNS A 0;
		"####" BCD 1
		{
			A_GiveInventory("ChaingunSpinupCounter");
			If (CountInv("Grabbing_A_Ledge"))
			{
				A_TakeInventory("ChaingunFireCounter");
			}
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !CountInv("MobileTurretSelected")|WRF_ALLOWRELOAD * ((CountInv("GatlingRotator") && CountInv("MobileTurret")) || ((CountInv("GatlingRotator") || CountInv("MobileTurret")) && (!CountInv("GatlingRotatorSelected") && !CountInv("MobileTurretSelected"))))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_ALLOWEQUIPMENT|EOA_DISABLEHASTE);
			If (CountInv("PowerHaste"))
			{
				If (GetSpeedCounter() >= 2)
				{
					SetSpeedCounter(0);
				}
				Else
				{
					SetSpeedCounter(GetSpeedCounter() + 1);
				}
			}
			A_SetTics(4 - (CountInv("PowerHaste") && GetSpeedCounter()) - CountInv("ChaingunSpinCounter") / 12);
			If (CountInv("ChaingunFireCounter") >= 8)
			{
				A_TakeInventory("ChaingunFireCounter");
			}
			A_GiveInventory("ChaingunFireCounter");
		}
		"####" "#" 0
		{
			A_SetInventory("ChaingunFireCounter", 3);
			If ((GetPlayerInput(INPUT_BUTTONS) & BT_ATTACK) && CountInv("MobileTurretSelected") && CountInv("MobileTurretOverheatCounter"))
			{
				A_ReFire("SpinAnim5");
			}
			Else
			{
				EOA_WeaponReady(WRF_NOSECONDARY|WRF_ALLOWZOOM|WRF_ALLOWRELOAD * ((CountInv("GatlingRotator") && CountInv("MobileTurret")) || ((CountInv("GatlingRotator") || CountInv("MobileTurret")) && (!CountInv("GatlingRotatorSelected") && !CountInv("MobileTurretSelected")))));
			}
		}
	SpinAnim5:
		CGRS A 0 A_JumpIfInventory("GatlingRotatorSelected", 1, 3);
		CGMS A 0 A_JumpIfInventory("MobileTurretSelected", 1, 2);
		CGNS A 0;
		"####" EFG 1
		{
			A_GiveInventory("ChaingunSpinupCounter");
			If (CountInv("Grabbing_A_Ledge"))
			{
				A_TakeInventory("ChaingunFireCounter");
			}
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !CountInv("MobileTurretSelected")|WRF_ALLOWRELOAD * ((CountInv("GatlingRotator") && CountInv("MobileTurret")) || ((CountInv("GatlingRotator") || CountInv("MobileTurret")) && (!CountInv("GatlingRotatorSelected") && !CountInv("MobileTurretSelected"))))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_ALLOWEQUIPMENT|EOA_DISABLEHASTE);
			If (CountInv("PowerHaste"))
			{
				If (GetSpeedCounter() >= 2)
				{
					SetSpeedCounter(0);
				}
				Else
				{
					SetSpeedCounter(GetSpeedCounter() + 1);
				}
			}
			A_SetTics(4 - (CountInv("PowerHaste") && GetSpeedCounter()) - CountInv("ChaingunSpinCounter") / 12);
			If (CountInv("ChaingunFireCounter") >= 8)
			{
				A_TakeInventory("ChaingunFireCounter");
			}
			A_GiveInventory("ChaingunFireCounter");
		}
		"####" "#" 0
		{
			A_SetInventory("ChaingunFireCounter", 4);
			If ((GetPlayerInput(INPUT_BUTTONS) & BT_ATTACK) && CountInv("MobileTurretSelected") && CountInv("MobileTurretOverheatCounter"))
			{
				A_ReFire("SpinAnim6");
			}
			Else
			{
				EOA_WeaponReady(WRF_NOSECONDARY|WRF_ALLOWZOOM|WRF_ALLOWRELOAD * ((CountInv("GatlingRotator") && CountInv("MobileTurret")) || ((CountInv("GatlingRotator") || CountInv("MobileTurret")) && (!CountInv("GatlingRotatorSelected") && !CountInv("MobileTurretSelected")))));
			}
		}
	SpinAnim6:
		CGRS A 0 A_JumpIfInventory("GatlingRotatorSelected", 1, 3);
		CGMS A 0 A_JumpIfInventory("MobileTurretSelected", 1, 2);
		CGNS A 0;
		"####" HAB 1
		{
			A_GiveInventory("ChaingunSpinupCounter");
			If (CountInv("Grabbing_A_Ledge"))
			{
				A_TakeInventory("ChaingunFireCounter");
			}
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !CountInv("MobileTurretSelected")|WRF_ALLOWRELOAD * ((CountInv("GatlingRotator") && CountInv("MobileTurret")) || ((CountInv("GatlingRotator") || CountInv("MobileTurret")) && (!CountInv("GatlingRotatorSelected") && !CountInv("MobileTurretSelected"))))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_ALLOWEQUIPMENT|EOA_DISABLEHASTE);
			If (CountInv("PowerHaste"))
			{
				If (GetSpeedCounter() >= 2)
				{
					SetSpeedCounter(0);
				}
				Else
				{
					SetSpeedCounter(GetSpeedCounter() + 1);
				}
			}
			A_SetTics(4 - (CountInv("PowerHaste") && GetSpeedCounter()) - CountInv("ChaingunSpinCounter") / 12);
			If (CountInv("ChaingunFireCounter") >= 8)
			{
				A_TakeInventory("ChaingunFireCounter");
			}
			A_GiveInventory("ChaingunFireCounter");
			If (CountInv("ChaingunSpinCounter") <= 6 && GetFrame() == 0)
			{
				Return ResolveState("SpinHalt");
			}
			Return ResolveState(Null);
		}
		"####" "#" 0
		{
			A_SetInventory("ChaingunFireCounter", 5);
			If ((GetPlayerInput(INPUT_BUTTONS) & BT_ATTACK) && CountInv("MobileTurretSelected") && CountInv("MobileTurretOverheatCounter"))
			{
				A_ReFire("SpinAnim7");
			}
			Else
			{
				EOA_WeaponReady(WRF_NOSECONDARY|WRF_ALLOWZOOM|WRF_ALLOWRELOAD * ((CountInv("GatlingRotator") && CountInv("MobileTurret")) || ((CountInv("GatlingRotator") || CountInv("MobileTurret")) && (!CountInv("GatlingRotatorSelected") && !CountInv("MobileTurretSelected")))));
			}
		}
	SpinAnim7:
		CGRS A 0 A_JumpIfInventory("GatlingRotatorSelected", 1, 3);
		CGMS A 0 A_JumpIfInventory("MobileTurretSelected", 1, 2);
		CGNS A 0;
		"####" CDE 1
		{
			A_GiveInventory("ChaingunSpinupCounter");
			If (CountInv("Grabbing_A_Ledge"))
			{
				A_TakeInventory("ChaingunFireCounter");
			}
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !CountInv("MobileTurretSelected")|WRF_ALLOWRELOAD * ((CountInv("GatlingRotator") && CountInv("MobileTurret")) || ((CountInv("GatlingRotator") || CountInv("MobileTurret")) && (!CountInv("GatlingRotatorSelected") && !CountInv("MobileTurretSelected"))))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_ALLOWEQUIPMENT|EOA_DISABLEHASTE);
			If (CountInv("PowerHaste"))
			{
				If (GetSpeedCounter() >= 2)
				{
					SetSpeedCounter(0);
				}
				Else
				{
					SetSpeedCounter(GetSpeedCounter() + 1);
				}
			}
			A_SetTics(4 - (CountInv("PowerHaste") && GetSpeedCounter()) - CountInv("ChaingunSpinCounter") / 12);
			If (CountInv("ChaingunFireCounter") >= 8)
			{
				A_TakeInventory("ChaingunFireCounter");
			}
			A_GiveInventory("ChaingunFireCounter");
		}
		"####" "#" 0
		{
			A_SetInventory("ChaingunFireCounter", 6);
			If ((GetPlayerInput(INPUT_BUTTONS) & BT_ATTACK) && CountInv("MobileTurretSelected") && CountInv("MobileTurretOverheatCounter"))
			{
				A_ReFire("SpinAnim8");
			}
			Else
			{
				EOA_WeaponReady(WRF_NOSECONDARY|WRF_ALLOWZOOM|WRF_ALLOWRELOAD * ((CountInv("GatlingRotator") && CountInv("MobileTurret")) || ((CountInv("GatlingRotator") || CountInv("MobileTurret")) && (!CountInv("GatlingRotatorSelected") && !CountInv("MobileTurretSelected")))));
			}
		}
	SpinAnim8:
		CGRS A 0 A_JumpIfInventory("GatlingRotatorSelected", 1, 3);
		CGMS A 0 A_JumpIfInventory("MobileTurretSelected", 1, 2);
		CGNS A 0;
		"####" FGH 1
		{
			A_GiveInventory("ChaingunSpinupCounter");
			If (CountInv("Grabbing_A_Ledge"))
			{
				A_TakeInventory("ChaingunFireCounter");
			}
			EOA_WeaponReady(WRF_NOPRIMARY|WRF_NOSECONDARY * !CountInv("MobileTurretSelected")|WRF_ALLOWRELOAD * ((CountInv("GatlingRotator") && CountInv("MobileTurret")) || ((CountInv("GatlingRotator") || CountInv("MobileTurret")) && (!CountInv("GatlingRotatorSelected") && !CountInv("MobileTurretSelected"))))|WRF_ALLOWZOOM * !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM), EOA_ALLOWMANTLE|EOA_ALLOWEQUIPMENT|EOA_DISABLEHASTE);
			If (CountInv("PowerHaste"))
			{
				If (GetSpeedCounter() >= 2)
				{
					SetSpeedCounter(0);
				}
				Else
				{
					SetSpeedCounter(GetSpeedCounter() + 1);
				}
			}
		//	A_SetTics(4 - (CountInv("PowerHaste") && GetSpeedCounter()) - CountInv("ChaingunSpinCounter") / 12);
			If (CountInv("ChaingunFireCounter") >= 8)
			{
				A_TakeInventory("ChaingunFireCounter");
			}
			A_GiveInventory("ChaingunFireCounter");
		}
		"####" "#" 0
		{
			A_SetInventory("ChaingunFireCounter", 7);
			If ((GetPlayerInput(INPUT_BUTTONS) & BT_ATTACK) && CountInv("MobileTurretSelected") && CountInv("MobileTurretOverheatCounter"))
			{
				A_ReFire("SpinAnim1");
			}
			Else
			{
				A_WeaponReady(WRF_NOSECONDARY|WRF_ALLOWZOOM|WRF_ALLOWRELOAD * ((CountInv("GatlingRotator") && CountInv("MobileTurret")) || ((CountInv("GatlingRotator") || CountInv("MobileTurret")) && (!CountInv("GatlingRotatorSelected") && !CountInv("MobileTurretSelected")))));
			}
		}
		"####" "#" 0 A_JumpIf(CountInv("ChaingunSpinCounter") <= 6, "SpinHalt");
		Goto SpinAnim1;
	SpinHalt:
		"####" "#" 1
		{
			EOA_SpawnNoiseMaker("CGN/Stop");
			A_TakeInventory("ChaingunFireCounter");
			EOA_WeaponReady(WRF_NOFIRE, EOA_ALLOWMANTLE|EOA_ALLOWEQUIPMENT);
		}
		Goto ReadyLoop;
	AltFire:
		"####" "#" 0 A_JumpIfInventory("MobileTurretSelected", 1, "TurretPrime");
		"####" "#" 0 A_JumpIf(CountInv("GatlingRotatorSelected") && !CountInv("ShieldCooldowntoken") && !CountInv("ShieldTimerToken") && !CountInv("UsingShield"), "ShieldPrime");
		goto readyloop;
	ShieldBreak:
		CGRS A 1
		{
			if(CountInv("DamageCounter") == 400)
			{
				A_StartSound("HeatBlast/Fire", 1);
				A_StartSound("HeatBlast/Fire", 2);
				A_StartSound("HeatBlast/Fire", 3);
				A_StartSound("HeatBlast/Fire", 4);
				A_StartSound("HeatBlast/Shrill", 5, 0, 0.25);
				A_StartSound("HeatBlast/Distort", 6, 0, 0.5);
				EOA_SetWeaponRecoilOffset(frandompick(-0.5, -0.25, 0.25, 0.5), -2.5, 0, 0.15);
				EOA_SpawnCustomDynamicLight("PLR_Light", DynamicLight.PulseLight, (25, 204, 255), 48, 1, DYNAMICLIGHT.LF_ADDITIVE|DYNAMICLIGHT.LF_ATTENUATE, 3, (0, 0, Height / 2), 0.1);
				EOA_ShieldOverHeat(400, 50);
			}
			A_TakeInventory("DamageCounter", 400);
			A_TakeInventory("ShieldCoolDownToken", 6);
			A_GiveInventory("ShieldCoolDownToken", 6 - CountInv("ShieldTimerToken"));
			A_TakeInventory("ShieldTimerToken", 6);
			bDONTTHRUST = False;
			bINVULNERABLE = False;
			A_TakeInventory("UsingShield", 1);
		}
		CGRS B 1;
		Goto ReadyLoop;
	ShieldPrime:
		"####" "#" 0 
			{
				bDONTTHRUST = True;
				bINVULNERABLE = True;
				A_GiveInventory("ShieldCoolDownToken", 6);
				A_GiveInventory("ShieldTimerToken", 6);
				A_GiveInventory("UsingShield", 1);
				//ACS_NAMEDEXECUTEALWAYS("ShieldTimer");
				A_Overlay(-15, "ShieldActivate", 1);
				EOA_SpawnNoiseMaker("Shield/Activate", 1);
				EOA_SpawnNoiseMaker("Shield/Loop", 10);
			}
		"####" "#" 5 A_ZoomFactor(0.88, ZOOM_NOSCALETURNING);
		goto readyloop;
	TurretPrime:
		TNT1 A 0 EOA_SpawnNoiseMaker("CGN/MTOpen");
		CGTM ABCDEFGHIJKLMNO 2
		{
			EOA_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH, EOA_WEAPSPEEDUPGRADE * CountInv("RapidDeployment"));
			If (!CountInv("MobileTurretSelected"))
			{
				Return ResolveState("TurretClose");
			}
			Else If (!(GetPlayerInput(INPUT_BUTTONS) & BT_ALTATTACK) || ((GetPlayerInput(INPUT_BUTTONS) & BT_ZOOM) && !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM)) || CountInv("Grabbing_A_Ledge"))
			{
				Return ResolveState("TurretClose");
			}
			Return ResolveState(Null);
		}
	TurretReady:
		CGTI A 1
		{
			A_GiveInventory("MobileTurretReady");
			EOA_WeaponReady(WRF_NOFIRE);
			If (!CountInv("MobileTurretSelected"))
			{
				Return ResolveState("TurretClose");
			}
			If ((GetPlayerInput(INPUT_BUTTONS) & BT_ATTACK) && (GetPlayerInput(INPUT_BUTTONS) & BT_ALTATTACK) && !CountInv("MobileTurretOverheatCounter") && (CountInv("EOA_BulletAmmo") || CheckInfiniteAmmo()))
			{
				If (CountInv("MTUraniumCoating"))
				{
					EOA_SpawnNoiseMaker("CGN/Fire/Uranium");
				}
				Else
				{
					EOA_SpawnNoiseMaker("CGN/Fire");
				}
				Return ResolveState("TurretFire");
			}
			Else If (!(GetPlayerInput(INPUT_BUTTONS) & BT_ALTATTACK) || ((GetPlayerInput(INPUT_BUTTONS) & BT_ZOOM) && !(GetPlayerInput(INPUT_OLDBUTTONS) & BT_ZOOM)) || CountInv("Grabbing_A_Ledge"))
			{
				Return ResolveState("TurretClose");
			}
			Else
			{
				If (CountInv("MobileTurretHeatCounter") && CountInv("MobileTurretHeatCounter") % 3 == 0)
				{
					A_FireBullets(18, 0, -1, 0, "MobileTurretSmokeSpawner", FBF_NORANDOMPUFFZ|FBF_EXPLICITANGLE|FBF_NOFLASH, 60);
					A_FireBullets(0, 10, -1, 0, "MobileTurretSmokeSpawner", FBF_NORANDOMPUFFZ|FBF_EXPLICITANGLE|FBF_NOFLASH, 60);
					A_FireBullets(-18, 0, -1, 0, "MobileTurretSmokeSpawner", FBF_NORANDOMPUFFZ|FBF_EXPLICITANGLE|FBF_NOFLASH, 60);
				}
				Return ResolveState(Null);
			}
		}
		Wait;
	TurretFire:
		CGTF A 0;
		"####" "#" 0 
		{
			If (CountInv("MobileTurretBarrelCounter") >= 3)
			{
				A_TakeInventory("MobileTurretBarrelCounter");
			}
			A_GiveInventory("MobileTurretBarrelCounter");
			If (CountInv("MobileTurretBarrelCounter") == 1)
			{
				EOA_FireBullets(3, 3, -1, 0, "EOA_NullPuff", FBF_NORANDOMPUFFZ, 32767, "ChaingunSlug", GetViewZ(), -4 + GetRelVelY() / 3, 2.5);
			}
			Else If (CountInv("MobileTurretBarrelCounter") == 2)
			{
				EOA_FireBullets(3, 3, -1, 0, "EOA_NullPuff", FBF_NORANDOMPUFFZ, 32767, "ChaingunSlug", -5 + GetViewZ(), 0 + GetRelVelY() / 3, 2.5);
			}
			Else If (CountInv("MobileTurretBarrelCounter") == 3)
			{
				EOA_FireBullets(3, 3, -1, 0, "EOA_NullPuff", FBF_NORANDOMPUFFZ, 32767, "ChaingunSlug", GetViewZ(), 4 + GetRelVelY() / 3, 2.5);
			}
			If (CountInv("MobileTurretSelected") && CountInv("MTUraniumCoating"))
			{
				EOA_SpawnCustomDynamicLight("CGNLight", DynamicLight.PulseLight, (25, 153, 255), 48, 1, DYNAMICLIGHT.LF_ADDITIVE|DYNAMICLIGHT.LF_ATTENUATE, 2, (0, 0, Height / 2), 0.1);
			}
			Else
			{
				EOA_SpawnCustomDynamicLight("CGNLight", DynamicLight.PulseLight, (255, 153, 76), 48, 1, DYNAMICLIGHT.LF_ADDITIVE|DYNAMICLIGHT.LF_ATTENUATE, 2, (0, 0, Height / 2), 0.1);
			}
			A_FireProjectile("EMGCasingSpawner", -60, 0, 5, 2, 0, -(5 + Pitch / 2));
			A_FireProjectile("EMGCasingSpawner", 60, 0, -5, 2, 0, -(5 + Pitch / 2));
			A_AlertMonsters();
			A_TakeInventory("EOA_BulletAmmo", 1, TIF_NOTAKEINFINITE);
			If (CountInv("PowerQDMG"))
			{
				EOA_SpawnNoiseMaker("QuadDamage/Shot");
			}
			If (CountInv("MTUraniumCoating"))
			{
				EOA_SpawnPersistentNoiseMaker(Invoker.SlotNumber, "CGN/MTFire/Uranium", 1, CHANF_LOOPING);
			}
			Else
			{
				EOA_SpawnPersistentNoiseMaker(Invoker.SlotNumber, "CGN/MTFire", 1, CHANF_LOOPING);
			}
			EOA_SpawnPersistentNoiseMaker(Invoker.SlotNumber, "CGN/MTCasings", 5, CHANF_LOOPING, 0.5);
		}
		"####" AB 1
		{
			EOA_WeaponReady(WRF_NOFIRE);
			A_WeaponOffset(frandom(-1, 1), frandom(32, 34));
			If (GetFrame() == 0)
			{
				EOA_SetWeaponRecoilOffset(0, 0, 1.25 * (1 + CountInv("PowerHaste")), 0.125);
				If (GetCVar("EOA_APRRecoil"))
				{
					A_ZoomFactor(0.995, ZOOM_NOSCALETURNING);
				}
			}
			Else
			{
				A_ZoomFactor();
			}
			If (CountInv("Grabbing_A_Ledge"))
			{
				Return ResolveState("TurretClose");
			}
			Return ResolveState(Null);
		}
		"####" "#" 0 A_ZoomFactor();
		"####" "#" 0 A_JumpIf(!CountInv("MobileTurretSelected"), "TurretClose");
		"####" "#" 0 A_JumpIf(!(GetPlayerInput(INPUT_BUTTONS) & BT_ATTACK) || !(GetPlayerInput(INPUT_BUTTONS) & BT_ALTATTACK) || CountInv("MobileTurretOverheatCounter"), "TurretPreSpindown");
		"####" "#" 0
		{
			If (CountInv("MobileTurretBarrelCounter") >= 3)
			{
				A_TakeInventory("MobileTurretBarrelCounter");
			}
			A_GiveInventory("MobileTurretBarrelCounter");
			If (CountInv("MobileTurretBarrelCounter") == 1)
			{
				EOA_FireBullets(3, 3, -1, 0, "EOA_NullPuff", FBF_NORANDOMPUFFZ, 32767, "ChaingunSlug", GetViewZ(), -4 + GetRelVelY() / 3, 2.5);
			}
			Else If (CountInv("MobileTurretBarrelCounter") == 2)
			{
				EOA_FireBullets(3, 3, -1, 0, "EOA_NullPuff", FBF_NORANDOMPUFFZ, 32767, "ChaingunSlug", -5 + GetViewZ(), 0 + GetRelVelY() / 3, 2.5);
			}
			Else If (CountInv("MobileTurretBarrelCounter") == 3)
			{
				EOA_FireBullets(3, 3, -1, 0, "EOA_NullPuff", FBF_NORANDOMPUFFZ, 32767, "ChaingunSlug", GetViewZ(), 4 + GetRelVelY() / 3, 2.5);
			}
			If (CountInv("MobileTurretSelected") && CountInv("MTUraniumCoating"))
			{
				EOA_SpawnCustomDynamicLight("CGNLight", DynamicLight.PulseLight, (25, 153, 255), 48, 1, DYNAMICLIGHT.LF_ADDITIVE|DYNAMICLIGHT.LF_ATTENUATE, 2, (0, 0, Height / 2), 0.1);
			}
			Else
			{
				EOA_SpawnCustomDynamicLight("CGNLight", DynamicLight.PulseLight, (255, 153, 76), 48, 1, DYNAMICLIGHT.LF_ADDITIVE|DYNAMICLIGHT.LF_ATTENUATE, 2, (0, 0, Height / 2), 0.1);
			}
			A_FireProjectile("EMGCasingSpawner", -60, 0, 5, 2, 0, -(5 + Pitch / 2));
			A_FireProjectile("EMGCasingSpawner", 60, 0, -5, 2, 0, -(5 + Pitch / 2));
			A_AlertMonsters();
			A_TakeInventory("EOA_BulletAmmo", 1, TIF_NOTAKEINFINITE);
			If (CountInv("PowerQDMG"))
			{
				EOA_SpawnNoiseMaker("QuadDamage/Shot");
			}
			If (CountInv("MTUraniumCoating"))
			{
				EOA_SpawnPersistentNoiseMaker(Invoker.SlotNumber, "CGN/MTFire/Uranium", 1, CHANF_LOOPING);
			}
			Else
			{
				EOA_SpawnPersistentNoiseMaker(Invoker.SlotNumber, "CGN/MTFire", 1, CHANF_LOOPING);
			}
			EOA_SpawnPersistentNoiseMaker(Invoker.SlotNumber, "CGN/MTCasings", 5, CHANF_LOOPING, 0.5);
		}
		"####" CDE 1
		{
			EOA_WeaponReady(WRF_NOFIRE);
			A_WeaponOffset(frandom(-1, 1), frandom(32, 34));
			If (GetFrame() == 2)
			{
				EOA_SetWeaponRecoilOffset(0, 0, -1.25 * (1 + CountInv("PowerHaste")), 0.125);
				If (GetCVar("EOA_APRRecoil"))
				{
					A_ZoomFactor(0.995, ZOOM_NOSCALETURNING);
				}
			}
		}
		"####" "#" 0 A_ZoomFactor();
		"####" "#" 0 A_JumpIf(!CountInv("MobileTurretSelected"), "TurretClose");
		"####" "#" 0 A_JumpIf((GetPlayerInput(INPUT_BUTTONS) & BT_ATTACK) && (GetPlayerInput(INPUT_BUTTONS) & BT_ALTATTACK) && (CountInv("EOA_BulletAmmo") || CheckInfiniteAmmo()) && !CountInv("MobileTurretOverheatCounter"), "TurretFire");
		Goto TurretSpindown;
	TurretPreSpindown:
		TNT1 A 0 
		{
			A_TakeInventory("MobileTurretReady");
			EOA_SpawnPersistentNoiseMaker(Invoker.SlotNumber, "", 1);
			EOA_SpawnPersistentNoiseMaker(Invoker.SlotNumber, "", 5);
		}
		CGTS CDE 1
		{
			EOA_WeaponReady(WRF_NOFIRE);
			If (CountInv("MobileTurretHeatCounter") && CountInv("MobileTurretHeatCounter") % 3 == 0)
			{
				A_FireBullets(18, 0, -1, 0, "MobileTurretSmokeSpawner", FBF_NORANDOMPUFFZ|FBF_EXPLICITANGLE|FBF_NOFLASH, 60);
				A_FireBullets(0, 10, -1, 0, "MobileTurretSmokeSpawner", FBF_NORANDOMPUFFZ|FBF_EXPLICITANGLE|FBF_NOFLASH, 60);
				A_FireBullets(-18, 0, -1, 0, "MobileTurretSmokeSpawner", FBF_NORANDOMPUFFZ|FBF_EXPLICITANGLE|FBF_NOFLASH, 60);
			}
			If (CountInv("Grabbing_A_Ledge"))
			{
				Return ResolveState("TurretClose");
			}
			Return ResolveState(Null);
		}
	TurretSpindown:
		TNT1 A 0 
		{
			A_TakeInventory("MobileTurretReady");
			A_ZoomFactor();
			EOA_SpawnPersistentNoiseMaker(Invoker.SlotNumber, "", 1);
			EOA_SpawnPersistentNoiseMaker(Invoker.SlotNumber, "", 5);
		}
		CGTS ABCDE 1
		{
			EOA_WeaponReady(WRF_NOFIRE);
			If (CountInv("MobileTurretHeatCounter") && CountInv("MobileTurretHeatCounter") % 3 == 0)
			{
				A_FireBullets(18, 0, -1, 0, "MobileTurretSmokeSpawner", FBF_NORANDOMPUFFZ|FBF_EXPLICITANGLE|FBF_NOFLASH, 60);
				A_FireBullets(0, 10, -1, 0, "MobileTurretSmokeSpawner", FBF_NORANDOMPUFFZ|FBF_EXPLICITANGLE|FBF_NOFLASH, 60);
				A_FireBullets(-18, 0, -1, 0, "MobileTurretSmokeSpawner", FBF_NORANDOMPUFFZ|FBF_EXPLICITANGLE|FBF_NOFLASH, 60);
			}
			If (CountInv("Grabbing_A_Ledge"))
			{
				EOA_SpawnNoiseMaker("CGN/MTClose");
				A_TakeInventory("MobileTurretReady");
				A_TakeInventory("UltimateCoolingKillCounter");
				Return ResolveState("LedgeClimb");
			}
			Return ResolveState(Null);
		}
		"####" "#" 0 EOA_SpawnNoiseMaker("CGN/Stop");
		Goto TurretReady;
	TurretClose:
		TNT1 A 0
		{
			A_ZoomFactor();
			A_TakeInventory("MobileTurretReady");
			A_TakeInventory("UltimateCoolingKillCounter");
			If (CountInv("MobileTurretSelected"))
			{
				EOA_SpawnNoiseMaker("CGN/MTClose");
			}
			EOA_SpawnPersistentNoiseMaker(Invoker.SlotNumber, "", 1);
			EOA_SpawnPersistentNoiseMaker(Invoker.SlotNumber, "", 5);
			Return A_JumpIf(!CountInv("MobileTurretSelected"), "ReadyLoop");
		}
		CGTM NMKJIFEDCBA 3
		{
			If (CountInv("Grabbing_A_Ledge"))
			{
				A_TakeInventory("ChaingunFireCounter");
				EOA_SpawnNoiseMaker("CGN/MTClose");
			}
			EOA_WeaponReady(WRF_NOFIRE|WRF_ALLOWZOOM, EOA_ALLOWMANTLE|EOA_ALLOWEQUIPMENT);
		}
		TNT1 A 0 A_TakeInventory("ChaingunSpinCounter"); //We take this so that the Chaingun doesn't fire at top speed once the turret closes, since it still gives counters.
		Goto ReadyLoop;
	Reload:
		TNT1 A 0 A_JumpIf(CountInv("GatlingRotator") && !CountInv("GatlingRotatorSelected"), "SwitchToGatlingRotator");
		TNT1 A 0 A_JumpIf(CountInv("MobileTurret") && !CountInv("MobileTurretSelected"), "SwitchToMobileTurret");
		Goto ReadyLoop;
	SwitchToGatlingRotator:
		CGMR A 0 A_JumpIfInventory("MobileTurretSelected", 1, 2);
		CGNR A 0;
		"####" HGFEDCBA 1;
	GatlingRotatorMod:
		"####" "#" 0 
		{
			A_StopSound(CHAN_WEAPON);
			A_TakeInventory("DamageCounter", 400);
			A_GiveInventory("GatlingRotatorSelected");
			A_TakeInventory("MobileTurretSelected");
			A_TakeInventory("ChaingunSpinupCounter");
			A_TakeInventory("ChaingunFireCounter");
			A_TakeInventory("ChaingunSpinCounter");
		}
		CGRM ABCDEFGHIJKLM 1 EOA_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH, EOA_ALLOWMANTLE|EOA_DISABLEHASTE|EOA_WEAPSPEEDUPGRADE * CountInv("HotSwap"));
		TNT1 A 0 EOA_SpawnNoiseMaker("GatlingRotator/Click");
		CGRM OOOOOOOOOOOO 1 EOA_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH, EOA_ALLOWMANTLE|EOA_DISABLEHASTE|EOA_WEAPSPEEDUPGRADE * CountInv("HotSwap"));
		TNT1 A 0 EOA_SpawnNoiseMaker("GatlingRotator/Attach");
		CGRM PPQQ 1 EOA_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH, EOA_ALLOWMANTLE|EOA_DISABLEHASTE|EOA_WEAPSPEEDUPGRADE * CountInv("HotSwap"));
		CGRM RSTUVWXYZ 1 EOA_WeaponReady(WRF_NOFIRE|WRF_ALLOWRELOAD * CountInv("MobileTurret"), EOA_ALLOWMANTLE|EOA_DISABLEHASTE|EOA_WEAPSPEEDUPGRADE * CountInv("HotSwap"));
		CGR2 ABCDEFGHHHHHHHHH 1 EOA_WeaponReady(WRF_NOFIRE|WRF_ALLOWRELOAD * CountInv("MobileTurret"), EOA_ALLOWMANTLE|EOA_DISABLEHASTE|EOA_WEAPSPEEDUPGRADE * CountInv("HotSwap"));
		TNT1 A 0 EOA_SpawnNoiseMaker("GatlingRotator/Punch");
		CGR2 IIIIIIJJJJ 1 EOA_WeaponReady(WRF_NOFIRE|WRF_ALLOWRELOAD * CountInv("MobileTurret"), EOA_ALLOWMANTLE|EOA_DISABLEHASTE|EOA_WEAPSPEEDUPGRADE * CountInv("HotSwap"));
		CGR2 KLMN 1 EOA_WeaponReady(WRF_NOFIRE|WRF_ALLOWRELOAD * CountInv("MobileTurret"), EOA_ALLOWMANTLE|EOA_DISABLEHASTE|EOA_WEAPSPEEDUPGRADE * CountInv("HotSwap"));
		Goto ReadyLoop;
	SwitchToMobileTurret:
		TNT1 A 0
		{
			If(CountInv("UsingShield"))
			{
				bINVULNERABLE = False;
				A_TakeInventory("UsingShield", 1);
				A_TakeInventory("ShieldTimerToken", 6);
			}
		}
		CGRR A 0 A_JumpIfInventory("GatlingRotatorSelected", 1, 2);
		CGNR A 0;
		"####" HGFEDCBA 1;
	MobileTurretMod:
		"####" "#" 0 
		{
			A_StopSound(CHAN_WEAPON);
			A_TakeInventory("DamageCounter", 400);
			A_GiveInventory("MobileTurretSelected");
			A_TakeInventory("GatlingRotatorSelected");
			A_TakeInventory("ChaingunSpinupCounter");
			A_TakeInventory("ChaingunFireCounter");
			A_TakeInventory("ChaingunSpinCounter");
		}
		TNT1 A 0 EOA_SpawnNoiseMaker("MobileTurret/Attach");
		CGMM ABCDEFGHIJKLMNOPQRSSSSSSSSSS 1 EOA_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH, EOA_ALLOWMANTLE|EOA_DISABLEHASTE|EOA_WEAPSPEEDUPGRADE * CountInv("HotSwap"));
		TNT1 A 0 EOA_SpawnNoiseMaker("MobileTurret/Lock");
		CGMM TTUUVWXY 1 EOA_WeaponReady(WRF_NOFIRE|WRF_ALLOWRELOAD * CountInv("GatlingRotator"), EOA_ALLOWMANTLE|EOA_DISABLEHASTE|EOA_WEAPSPEEDUPGRADE * CountInv("HotSwap"));
		CGM2 AAAAAAAA 1 EOA_WeaponReady(WRF_NOFIRE|WRF_ALLOWRELOAD * CountInv("GatlingRotator"), EOA_ALLOWMANTLE|EOA_DISABLEHASTE|EOA_WEAPSPEEDUPGRADE * CountInv("HotSwap"));
		TNT1 A 0 EOA_SpawnNoiseMaker("MobileTurret/Whirr");
		CGM2 ABCDABCDABCDAAAEEE 1 EOA_WeaponReady(WRF_NOFIRE|WRF_ALLOWRELOAD * CountInv("GatlingRotator"), EOA_ALLOWMANTLE|EOA_DISABLEHASTE);
		Goto ReadyLoop;
	LedgeClimb:
		TNT1 A 0
		{
			A_StopSound(CHAN_WEAPON);
			A_TakeInventory("ChaingunSpinCounter");
			A_TakeInventory("ChaingunFireCounter");
			A_TakeInventory("ChaingunSpinupCounter");
		}
		Goto Super::LedgeClimb;
	Zoom:
		CGRI A 0 A_JumpIfInventory("GatlingRotatorSelected", 1, 3);
		CGMI A 0 A_JumpIfInventory("MobileTurretSelected", 1, 2);
		CGNI A 0;
		"####" "#" 0
		{
			A_StopSound(CHAN_WEAPON);
			A_TakeInventory("ChaingunSpinCounter");
			A_TakeInventory("ChaingunFireCounter");
			A_TakeInventory("ChaingunSpinupCounter");
		}
		Goto Super::Melee;
	UseEquipment:
		CGRT A 0 A_JumpIfInventory("GatlingRotatorSelected", 1, 3);
		CGMT A 0 A_JumpIfInventory("MobileTurretSelected", 1, 2);
		CGNT A 0;
		"####" "#" 0
		{
			A_TakeInventory("ChaingunSpinCounter");
			A_TakeInventory("ChaingunFireCounter");
			A_TakeInventory("ChaingunSpinupCounter");
		}
		Goto Super::UseEquipment;
	}
}

Class ChaingunSlug : EOA_FastProjectile //[DoomKrakken]: Remember that it fires 15mm tungsten slugs instead of 12.7mm (.50 cal) FMJ rounds, even though it draws from the same ammo pool as the Heavy Assault Rifle.  I assume that it's because it's being made with Argent Energy, so it's actually being crafted from a form of Argent that creates bullet-type rounds, regardless of the caliber.  
{
	Default
	{
		Scale 0.5;
		Radius 0.5;
		Height 1;
		DamageFunction 30;
		Decal "";
		RenderStyle "Add";
		+DONTBLAST
		+DONTREFLECT
		+NOEXTREMEDEATH
		EOA_Projectile.PuffType "ChaingunPuff";
	}
	Override Void Tick()
	{
		Super.Tick();
	}
	Override Void PostBeginPlay()
	{
		If (Target)
		{
			If ((Target.CountInv("GRUraniumCoating") && Target.CountInv("GatlingRotatorSelected")) || (Target.CountInv("MTUraniumCoating") && Target.CountInv("MobileTurretSelected")))
			{
				If (!Target.CountInv("PowerQDMG") && !Target.CountInv("MobileTurretSelected"))
				{
					A_SetTranslation("Silver");
				}
				bRIPPER = True;
			}
			If (Target.CountInv("MobileTurretSelected"))
			{
				A_GiveInventory("MobileTurretSelected");
			}
			If (Target.CountInv("MobileTurretReady"))
			{
				A_GiveInventory("MobileTurretReady");
			}
		}
		EOA_Projectile.PostBeginPlay();
	}
	Override Int DoSpecialDamage(Actor Target, Int Damage, Name DamageType)
	{
		//[DoomKrakken]: Copied over from PostBeginPlay, in case the projectile "dies" before it's fully spawned.
		PlayerInfo Player = Players[ConsolePlayer];
		If (!GetAge())
		{
			If (Self.Target)
			{
				If ((Self.Target.CountInv("GRUraniumCoating") && Self.Target.CountInv("GatlingRotatorSelected")) || (Self.Target.CountInv("MTUraniumCoating") && Self.Target.CountInv("MobileTurretSelected")))
				{
					If (!Self.Target.CountInv("PowerQDMG") && !Self.Target.CountInv("MobileTurretSelected"))
					{
						A_SetTranslation("Silver");
					}
					If (!bRIPPER)
					{
						Damage = 0;
					}
					bRIPPER = True;
				}
				If (Self.Target.CountInv("MobileTurretSelected"))
				{
					A_GiveInventory("MobileTurretSelected");
				}
				If (Self.Target.CountInv("MobileTurretReady"))
				{
					A_GiveInventory("MobileTurretReady");
				}
			}
		}
		If (CountInv("MobileTurretReady"))
		{
			Damage += 5;
		}
		If (Player.Mo.CountInv("UsingShield") && Player.Mo.CountInv("IncendiaryRounds"))
		{
			Player.Mo.A_GiveInventory("DamageCounter", 20);
		}
		Return EOA_Projectile.DoSpecialDamage(Target, Damage, DamageType);
	}
	States
	{
	Spawn:
		TRAC B 0 NoDelay A_JumpIfInTargetInventory("PowerQDMG", 1, 2);
		TRAC A 0;
		TRAC "#" 1 Bright;
		Wait;
	Death:
	Crash:
		TNT1 A 1 A_StartSound("Projectile/HitWall");
		Stop;
	XDeath:
		TNT1 A 1 A_StartSound("Projectile/HitFlesh");
		Stop;
	}
}

Class ChaingunIncendiarySlug : ChaingunSlug
{
	Default
	{
		DamageFunction 38;
		Decal "ChaingunPuff";
		EOA_Projectile.PuffType "ChaingunPuff";
	}
	States
	{
	Death:
	Crash:
		TNT1 A 1 A_StartSound("Projectile/HitWall");
		Stop;
	XDeath:
		TNT1 A 1 A_StartSound("Projectile/HitFlesh");
		Stop;
	}
}

Class MobileTurretSmokeSpawner : Actor
{
	Default
	{
		+ALWAYSPUFF
		+BLOODLESSIMPACT
		+NOTRIGGER
		+PUFFGETSOWNER
	}
	States
	{
	Spawn:
		TNT1 A 1 NoDelay A_SpawnItemEx("MobileTurretSmoke", 0, 0, 0, 0, 0, 1, 0, SXF_TRANSFERPOINTERS|SXF_NOCHECKPOSITION);
		Stop;
	}
}

Class MobileTurretSmoke : FragGrenadeSmoke
{
	Default
	{
		Scale 0.01;
		+DONTBLAST
		+DONTTHRUST
		+NOINTERACTION
		+NOTRIGGER
	}
	States
	{
	Spawn:
		TNT1 A 0 NoDelay 
		{
			A_SetRoll(frandom(0.0, 359.0));
			If (CountInv("MobileTurretOverheatCounter", AAPTR_TARGET))
			{
				A_SetScale(Scale.X * 5);
			}
			Return A_Jump(256, random(1, 24));
		}
		GSMK ABCDEFGHIJKLMNOPQRSTUVWX 0 A_Jump(256, "SetSprite");
	SetSprite:
		"####" "#" 1
		{
			A_FadeOut(0.02);
			A_SetScale(Scale.X + 0.01);
		}
		Loop;
	}
}

Class EOA_ChaingunBrass : EOA_EmptyBrass
{
	Default
	{
		Radius 3;
		Height 3;
		Scale 0.15;
	}
}

Class EOA_ChaingunBrassLeft : EOA_ChaingunBrass
{
	States
	{
	Spawn:
		TNT1 A 0 NoDelay A_ChangeVelocity(0, frandom(0.0, -2.0), frandom(0.0, 2.0), CVF_RELATIVE);
		Goto SpawnLoop;
	}
}

Class ChaingunPuff : Actor
{
	Default
	{
		Radius 0.1;
		Height 0.1;
		RenderStyle "Add";
		Alpha 0.99;
		Scale 0.125;
		//Translation "0:255=%[0,0,0]:[0.6,1.0,1.8]";
		+BRIGHT
		+ROLLSPRITE
		+ROLLCENTER
		+NOINTERACTION
		+FORCEXYBILLBOARD
		+DONTBLAST
		+DONTTHRUST
	}
	States
	{
	Spawn:
		TNT1 A 0 NoDelay
		{
			A_SetRoll(random(0, 359));
			EOA_ActorExtensions.SpawnCustomDynamicLight(Self, "EMGAddLight", DynamicLight.PulseLight, (25, 204, 255), 32, 1, DYNAMICLIGHT.LF_ADDITIVE, 4, (0, 0, Height / 2), 0.1);
			EOA_ActorExtensions.SpawnCustomDynamicLight(Self, "EMGAttLight", DynamicLight.PulseLight, (25, 204, 255), 32, 1, DYNAMICLIGHT.LF_ATTENUATE, 4, (0, 0, Height / 2), 0.1);
			A_SpawnItemEx("EOA_PlasmaPuff", Flags: SXF_NOCHECKPOSITION|SXF_TRANSFERSCALE);
			A_SpawnItemEx("EMGPuffFXSmall", Flags: SXF_NOCHECKPOSITION);
			A_SetScale(0.2);
		}
		//TNT1 AAAAAAAAAAAAAAAAAAAAAAAA 0 A_SpawnItemEx("GaussCannonImpactSpark", 0, 0, 0, frandom(0, 5), 0, frandom(-5, 5), random(1, 360), SXF_NOCHECKPOSITION|SXF_TRANSFERSCALE);
		TNT1 A 0 
		{
			A_SetScale(0.25);
			Return A_Jump(256, "FX1", "FX2");
		}
	FX1:
		PPUF ACEGIKMO 1;
		Stop;
	FX2:
		PPUF BDFHJLNP 1;
		Stop;
	}
}

Class ChaingunIncendiaryPuff : ChaingunPuff
{
	States
	{
	Spawn:
		TNT1 AAAAAAAAAAAAAAAAAAAA 0 NoDelay A_SpawnProjectile("ChaingunIncendiaryPuffSpark", 0, 0, random(1, 360), CMF_AIMDIRECTION, random(-90, 45));
		TNT1 A 6
		{
			A_SpawnItemEx("EMGPuffPlain", Flags: SXF_NOCHECKPOSITION);
			A_SpawnItemEx("EMGPuffFXSmall", Flags: SXF_NOCHECKPOSITION);
			A_SpawnItemEx("ChaingunIncendiaryPuffFX", Flags: SXF_NOCHECKPOSITION);
			A_SpawnItemEx("ChaingunIncendiaryExplosionFX", Flags: SXF_NOCHECKPOSITION);
			A_SetScale(0.04);
			A_SpawnItemEx("GaussCannonImpactShockwave", Flags: SXF_NOCHECKPOSITION|SXF_TRANSFERSCALE);
			EOA_ActorExtensions.SpawnCustomDynamicLight(Self, "CGNAddLight", DynamicLight.PulseLight, (25, 153, 255), 64, 1, DYNAMICLIGHT.LF_ADDITIVE, 6, (0, 0, Height / 2), 0.15);
			EOA_ActorExtensions.SpawnCustomDynamicLight(Self, "CGNAttLight", DynamicLight.PulseLight, (25, 153, 255), 64, 1, DYNAMICLIGHT.LF_ATTENUATE, 6, (0, 0, Height / 2), 0.15);
		}
		Stop;
	}
}

Class ChaingunUraniumPuffSpark : GaussCannonImpactSpark
{
	Default
	{
		Scale 0.2;
		Speed 5;
	}
}

Class ChaingunPuffSpark : ChaingunUraniumPuffSpark
{
	Default
	{
		Translation "Normal";
	}
}

Class ChaingunIncendiaryPuffSpark : GaussCannonImpactSpark
{
	Default
	{
		Scale 0.3;
	}
}

Class ChaingunIncendiaryExplosionFX : HARDevastatorPuffSpark
{
	Default
	{
		Translation "Cyan";
		Alpha 0.5;
	}
}

Class ChaingunIncendiaryPuffFX : HARSmoke
{
	Default
	{
		Translation "0:255=%[0, 0, 0]:[1.07, 1.65, 2]";
		Alpha 0.5;
	}
}

//Enemy Plasma
Class RedPlasmaPuffSpark : ChaingunPuffSpark
{
	Default
	{
		Translation "Red";
	}
}